<style lang="scss" scoped>
@import "../index.scss";

.echarts-main__flex__child {
  position: relative;
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: center;
}

.echarts-main__flex__child__echarts {
  position: absolute;
  width: 166px;
  height: 146px;
  top: 50%;
  left: 155px;
  z-index: 2;
  transform: translate(0%, -50%);
}

.echarts-main__flex__child__text-list {
  cursor: pointer;
  position: absolute;
  width: 200px;
  right: 44px;
  top: 50%;
  transform: translate(0, -50%);
  display: flex;
  flex-direction: column;
  align-items: center;

  .echarts-main__flex__child__text-list__box0 {
    display: flex;
    flex-direction: row;
    align-items: center;

    .echarts-main__flex__child__text-list__box__left {
      width: 12.5px;
      height: 11.5px;
      opacity: 0.63;
      margin-right: 11px;
      background: #e2a142;
    }

    .echarts-main__flex__child__text-list__box__center {
      min-width: 70px;
      height: 20px;
      font-size: 14px;
      font-family: PingFangSC-Semibold, PingFang SC;
      font-weight: 600;
      color: RGBA(162, 165, 175, 1);
      line-height: 20px;
      margin-right: 23px;
    }

    .echarts-main__flex__child__text-list__box__right {
      min-width: 40px;
      height: 20px;
      text-align: right;
      font-size: 14px;
      font-family: PingFangSC-Semibold, PingFang SC;
      font-weight: 600;
      color: RGBA(162, 165, 175, 1);
      line-height: 20px;
    }
  }

  .echarts-main__flex__child__text-list__box2 {
    display: flex;
    flex-direction: row;
    align-items: center;

    .echarts-main__flex__child__text-list__box__left {
      width: 12.5px;
      height: 11.5px;
      opacity: 0.63;
      margin-right: 11px;
      background: rgba(200, 255, 252, 1);
    }

    .echarts-main__flex__child__text-list__box__center {
      min-width: 70px;
      height: 20px;
      font-size: 14px;
      font-family: PingFangSC-Semibold, PingFang SC;
      font-weight: 600;
      color: RGBA(162, 165, 175, 1);
      line-height: 20px;
      margin-right: 23px;
    }

    .echarts-main__flex__child__text-list__box__right {
      min-width: 40px;
      height: 20px;
      text-align: right;
      font-size: 14px;
      font-family: PingFangSC-Semibold, PingFang SC;
      font-weight: 600;
      color: RGBA(162, 165, 175, 1);
      line-height: 20px;
    }
  }

  .echarts-main__flex__child__text-list__box4 {
    display: flex;
    flex-direction: row;
    align-items: center;

    .echarts-main__flex__child__text-list__box__left {
      width: 12.5px;
      height: 11.5px;
      opacity: 0.63;
      margin-right: 11px;
      background: rgba(57, 221, 213, 1);
    }

    .echarts-main__flex__child__text-list__box__center {
      min-width: 70px;
      height: 20px;
      font-size: 14px;
      font-family: PingFangSC-Semibold, PingFang SC;
      font-weight: 600;
      color: RGBA(162, 165, 175, 1);
      line-height: 20px;
      margin-right: 23px;
    }

    .echarts-main__flex__child__text-list__box__right {
      min-width: 40px;
      height: 20px;
      text-align: right;
      font-size: 14px;
      font-family: PingFangSC-Semibold, PingFang SC;
      font-weight: 600;
      color: RGBA(162, 165, 175, 1);
      line-height: 20px;
    }
  }

  .echarts-main__flex__child__text-list__box6 {
    display: flex;
    flex-direction: row;
    align-items: center;

    .echarts-main__flex__child__text-list__box__left {
      width: 12.5px;
      height: 11.5px;
      opacity: 0.63;
      margin-right: 11px;
      background: rgba(131, 226, 66, 1);
    }

    .echarts-main__flex__child__text-list__box__center {
      min-width: 70px;
      height: 20px;
      font-size: 14px;
      font-family: PingFangSC-Semibold, PingFang SC;
      font-weight: 600;
      color: RGBA(162, 165, 175, 1);
      line-height: 20px;
      margin-right: 23px;
    }

    .echarts-main__flex__child__text-list__box__right {
      min-width: 40px;
      height: 20px;
      text-align: right;
      font-size: 14px;
      font-family: PingFangSC-Semibold, PingFang SC;
      font-weight: 600;
      color: RGBA(162, 165, 175, 1);
      line-height: 20px;
    }
  }

  .echarts-main__flex__child__text-list__box8 {
    display: flex;
    flex-direction: row;
    align-items: center;

    .echarts-main__flex__child__text-list__box__left {
      width: 12.5px;
      height: 11.5px;
      opacity: 0.63;
      margin-right: 11px;
      background: rgba(146, 215, 163, 1);
    }

    .echarts-main__flex__child__text-list__box__center {
      min-width: 70px;
      height: 20px;
      font-size: 14px;
      font-family: PingFangSC-Semibold, PingFang SC;
      font-weight: 600;
      color: RGBA(162, 165, 175, 1);
      line-height: 20px;
      margin-right: 23px;
    }

    .echarts-main__flex__child__text-list__box__right {
      min-width: 40px;
      height: 20px;
      text-align: right;
      font-size: 14px;
      font-family: PingFangSC-Semibold, PingFang SC;
      font-weight: 600;
      color: RGBA(162, 165, 175, 1);
      line-height: 20px;
    }
  }

  .echarts-main__flex__child__text-list__box__left--active {
    width: 14px !important;
    height: 13px !important;
    opacity: 1 !important;
  }

  .echarts-main__flex__child__text-list__box__center--active {
    height: 22px !important;
    font-size: 16px !important;
    font-family: PingFangSC-Semibold, PingFang SC;
    font-weight: 600;
    color: #ffffff !important;
    line-height: 22px;
    opacity: 1 !important;
  }
}

.echarts-main__flex__child__img {
  position: absolute;
  width: 86px;
  height: 86px;
  left: 196px;
  top: 50%;
  border-radius: 50%;
  margin-top: -43px;
  // background-color: salmon;
  background: url("~@/assets/images/zhdjPageRightBodyItemEchartsBg.png") no-repeat no-repeat;
  background-size: 100% 100%;
  transform: rotate(0deg);
  animation: echartsMapBgAni 18s linear infinite;
}

@keyframes echartsMapBgAni {
  0% {
    transform: rotate(0deg);
  }

  100% {
    transform: rotate(360deg);
  }
}

.echarts-main__flex__child__font-box {
  position: absolute;
  left: 200px;
  top: 50%;
  width: 80px;
  height: 100%;
  transform: translate(0, -50%);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;

  .echarts-main__flex__child__font-box__title {
    height: 20px;
    font-size: 14px;
    font-family: PingFangSC-Semibold, PingFang SC;
    font-weight: 600;
    color: RGBA(160, 164, 173, 1);
    line-height: 20px;
  }

  .echarts-main__flex__child__font-box__number {
    height: 27px;
    font-size: 24px;
    font-family: zcoolqingkehuangyouti-Regular, zcoolqingkehuangyouti;
    font-weight: 400;
    color: #ffffff;
    line-height: 28px;
  }
}
</style>
<template>
  <div class="echarts-main flex-column-center">
    <div class="echarts-main__flex flex-column-center">
      <div class="echarts-main__flex__child">
        <!--图表-->
        <div class="echarts-main__flex__child__echarts" ref="dynamicEcharts"></div>
        <!--图表列表-->
        <div class="echarts-main__flex__child__text-list">
          <div :class="'echarts-main__flex__child__text-list__box' + index" v-for="(item, index) in aEchartsData"
            :key="index" @mouseover="setEchartsHover(index)">
            <template v-if="index % 2 == 0">
              <div class="echarts-main__flex__child__text-list__box__left" :class="index == nEchartsHoverIndex
            ? 'echarts-main__flex__child__text-list__box__left--active'
            : ''
            "></div>
              <div class="echarts-main__flex__child__text-list__box__center" :class="index == nEchartsHoverIndex
            ? 'echarts-main__flex__child__text-list__box__center--active'
            : ''
            ">
                {{ item.name }}
              </div>
              <div class="echarts-main__flex__child__text-list__box__right" :class="index == nEchartsHoverIndex
            ? 'echarts-main__flex__child__text-list__box__center--active'
            : ''
            ">
                {{ item.value }}人
              </div>
            </template>

          </div>
        </div>
        <!--图表圆圈-->
        <div class="echarts-main__flex__child__img"></div>
        <!--图表文字-->
        <div class="echarts-main__flex__child__font-box">
          <div class="echarts-main__flex__child__font-box__title">
            {{ sEchartsName }}
          </div>
          <div class="echarts-main__flex__child__font-box__number">
            {{ nEchartsNum
            }}<span style="color:RGBA(160, 164, 173, 1);font-size: 14px;"> %</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
export default {
  name: "EchartsDynamicPie",
  data() {
    return {
      //图表实例对象
      oEchartsInstanceObject: null,
      //图表数组
      oEchartsOptions: null,
      //图表hover索引
      nEchartsHoverIndex: 0,
      //图表数据
      aEchartsData: [{ name: "", value: 0 }],
      //图表总量
      nEchartsNumsAll: 0,
    }
  },
  beforeCreate() {

  },
  created() {

  },
  computed: {
    //当前展示文字
    sEchartsName() {
      return this.aEchartsData[this.nEchartsHoverIndex].name;
    },
    //当前展示数值
    nEchartsNum() {
      let num;
      if (
        this.aEchartsData[this.nEchartsHoverIndex].value == 0 &&
        this.nEchartsNumsAll == 0
      ) {
        num = 0;
      } else {
        num =
          (
            this.aEchartsData[this.nEchartsHoverIndex].value / this.nEchartsNumsAll
          ).toFixed(2) * 100;
      }
      return num;
    },
  },
  watch: {
  },
  mounted() {
    if (this.oEchartsInstanceObject) {
      this.oEchartsInstanceObject.clear();
    }
    this.getEchartsData()

  },
  methods: {
    //获得图表数据
    getEchartsData() {
      let e = {
        onFiftySix: 16,
        underTwentyFive: 20,
        twentySixToThirtyFive: 30,
        thirtySixToFortyFive: 40,
        fortySixToFiftyFive: 50,
      }
      this.setEchartsData(e)
    },
    //派发数据
    setEchartsData(e) {
      this.nEchartsNumsAll = 0;
      this.nEchartsHoverIndex = 0;
      this.aEchartsData = [
        { value: e.onFiftySix, name: "56岁及以上" },
        {
          value: 2,
          name: "",
          itemStyle: {
            color: "transparent",
          },
        },
        { value: e.underTwentyFive, name: "25岁以下" },
        {
          value: 2,
          name: "",
          itemStyle: {
            color: "transparent",
          },
        },
        { value: e.twentySixToThirtyFive, name: "26-35岁" },
        {
          value: 2,
          name: "",
          itemStyle: {
            color: "transparent",
          },
        },
        { value: e.thirtySixToFortyFive, name: "36-45岁" },
        {
          value: 2,
          name: "",
          itemStyle: {
            color: "transparent",
          },
        },
        { value: e.fortySixToFiftyFive, name: "46-55岁" },
        {
          value: 2,
          name: "",
          itemStyle: {
            color: "transparent",
          },
        },
      ];
      this.nEchartsNumsAll =
        this.nEchartsNumsAll +
        e.onFiftySix +
        e.underTwentyFive +
        e.twentySixToThirtyFive +
        e.thirtySixToFortyFive +
        e.fortySixToFiftyFive;
      this.oEchartsOptions = {
        color: ["#E2A142", "#C8FFFC", "#39DDD5", "#83E242", "#92D7A3"],
        tooltip: {
          show: false,
        },
        legend: {
          show: false,
        },
        series: [
          {
            name: "Access From",
            type: "pie",
            radius: ["75%", "90%"],
            avoidLabelOverlap: false,
            label: {
              show: false,
              position: "center",
            },
            labelLine: {
              show: false,
            },
            emphasis: {
              scaleSize: 7,
              scale: true,
              focus: "self",
              itemStyle: {},
            },
            blur: {
              itemStyle: {
                opacity: "1",
              },
            },
            itemStyle: {
              // borderWidth:'20',
              // borderColor:'transparent',
            },
            zlevel: 2,
            data: this.aEchartsData,
          },
          {
            name: "Access From",
            type: "pie",
            radius: ["75%", "90%"],
            selectedMode: true,
            select: {
              disabled: false,
            },
            label: {
              show: false,
              position: "center",
            },
            labelLine: {
              show: false,
            },
            // itemStyle:{
            //   borderWidth:'20',
            //   borderColor:'transition',
            // },
            zlevel: 1,
            data: [
              {
                value: 0,
                name: "",
                itemStyle: {
                  color: "#0F3B4A",
                },
              },
            ],
          },
        ],
      };
      this.oEchartsInstanceObject = echarts.init(this.$refs.dynamicEcharts);
      this.oEchartsInstanceObject.setOption(this.oEchartsOptions);
      this.oEchartsInstanceObject.dispatchAction({
        type: "highlight",
        seriesIndex: 0,
        dataIndex: 0,
      });
      this.oEchartsInstanceObject.on("mouseover", (e) => {
        // console.log(e);
        if (this.aEchartsData[e.dataIndex].value == 2) {
          return;
        }
        //记录索引
        this.nEchartsHoverIndex = e.dataIndex;
        //高亮Hover元素，排他
        for (let i = 0; i <= 10; i++) {
          if (i == e.dataIndex) {
            this.oEchartsInstanceObject.dispatchAction({
              type: "highlight",
              seriesIndex: 0,
              dataIndex: i,
            });
          } else {
            this.oEchartsInstanceObject.dispatchAction({
              type: "downplay",
              seriesIndex: 0,
              dataIndex: i,
            });
          }
        }
      });
    },
    //文字hoverEcharts
    setEchartsHover(e) {
      // console.log(e);
      this.oEchartsInstanceObject.dispatchAction({
        type: "highlight",
        seriesIndex: 0,
        dataIndex: e,
      });
      //记录索引
      this.nEchartsHoverIndex = e;
    },
  }
}
</script>